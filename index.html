<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>OData Fetcher Pro X - Revamp</title>
        <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
        <style>
            /* Minimal custom CSS, mostly for scrollbars and fixed layout */
            ::-webkit-scrollbar { width: 6px; height: 6px; }
            ::-webkit-scrollbar-track { background: #f1f5f9; /* slate-100 */ border-radius: 3px; }
            ::-webkit-scrollbar-thumb { background: #94a3b8; /* slate-400 */ border-radius: 3px; }
            ::-webkit-scrollbar-thumb:hover { background: #64748b; /* slate-500 */ }
            .modal-backdrop { transition: opacity 0.2s ease-out; }
            .modal-content { transition: transform 0.2s ease-out, opacity 0.2s ease-out; }
            #mobileSidebar { transform: translateX(-100%); transition: transform 0.3s ease-in-out; }
            #mobileSidebar.open { transform: translateX(0); }
            html, body { height: 100%; margin: 0; overflow: hidden; }
            .app-shell { display: flex; flex-direction: column; height: 100vh; }
            .app-body { display: flex; flex-grow: 1; overflow: hidden; }
        </style>
    </head>
    <body class="font-sans bg-slate-100 text-slate-800 antialiased">
        <div class="app-shell">
            <!-- Top Header Bar -->
            <header class="bg-slate-800 text-white shadow-lg p-3 flex items-center justify-between z-20 flex-shrink-0">
                <div class="flex items-center space-x-3">
                    <button id="openMobileSidebarButton" class="md:hidden p-1.5 text-slate-300 hover:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                    <h1 class="text-xl font-semibold tracking-tight">OData Fetcher <span class="text-sky-400">Pro X</span></h1>
                </div>
                <div id="headerConnectionName" class="text-sm text-slate-300 truncate hidden md:block mx-4 flex-grow text-center">
                    No Connection Selected
                </div>
                <div class="flex items-center space-x-3">
                    <button id="exportConnectionsButton" title="Export Connections" class="p-1.5 text-slate-300 hover:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg>
                    </button>
                    <label for="importConnectionsInput" title="Import Connections" class="p-1.5 text-slate-300 hover:text-white rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 cursor-pointer">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                        </svg>
                    </label>
                    <input type="file" id="importConnectionsInput" class="hidden" accept=".json">
                </div>
            </header>
            <div class="app-body">
                <!-- Desktop Sidebar -->
                <aside id="desktopSidebar" class="hidden md:flex md:flex-col w-72 bg-slate-50 border-r border-slate-200 flex-shrink-0">
                    <div class="p-4">
                        <button id="newConnectionButton" class="w-full flex items-center justify-center space-x-2 bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2.5 px-4 rounded-lg transition-colors duration-150 cursor-pointer text-sm">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            <span>New Connection</span>
                        </button>
                    </div>
                    <div class="flex-grow overflow-y-auto px-4 pb-4">
                        <h2 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2 sticky top-0 bg-slate-50 py-1 z-10">Connections</h2>
                        <ul id="savedConnectionsList" class="space-y-1">
                            <li class="text-center text-slate-400 text-sm py-4">No connections yet.</li>
                        </ul>
                    </div>
                </aside>
                <!-- Mobile Sidebar (Overlay) -->
                <aside id="mobileSidebar" class="fixed inset-y-0 left-0 z-40 flex flex-col w-72 bg-slate-50 border-r border-slate-200 p-4 space-y-4 md:hidden shadow-xl">
                    <div class="flex justify-between items-center pt-12">
                        <h1 class="text-lg font-bold text-sky-600">Connections</h1>
                        <button id="closeMobileSidebarButton" class="p-1 text-slate-500 hover:text-slate-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <button id="newConnectionButtonMobile" class="w-full flex items-center justify-center space-x-2 bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2.5 px-4 rounded-lg transition-colors duration-150 cursor-pointer text-sm">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        <span>New Connection</span>
                    </button>
                    <div class="flex-grow overflow-y-auto">
                        <ul id="savedConnectionsListMobile" class="space-y-1">
                            <li class="text-center text-slate-400 text-sm py-4">No connections yet.</li>
                        </ul>
                    </div>
                </aside>
                <div id="mobileSidebarBackdrop" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden"></div>
                <!-- Main Content Area (Editor + Log) -->
                <main class="flex-1 flex flex-col bg-white overflow-hidden">
                    <!-- Editor Pane (Scrollable) -->
                    <div id="editorPane" class="flex-1 flex flex-col p-4 md:p-6 overflow-y-auto space-y-6">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <h2 id="connectionFormTitle" class="text-2xl font-semibold text-slate-700 mb-2 sm:mb-0 truncate">Connection Details</h2>
                            <button id="saveConnectionButton" class="w-full sm:w-auto bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 px-6 rounded-lg transition-colors duration-150 cursor-pointer text-sm flex items-center justify-center space-x-2">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                </svg>
                                <span>Save</span>
                            </button>
                        </div>
                        <!-- Tabs - New Style -->
                        <div class="border-b border-slate-200 sticky top-0 bg-white z-10 pt-1 -mx-4 px-4 md:-mx-6 md:px-6">
                            <nav id="editorTabs" class="flex space-x-1" aria-label="Tabs">
                                <button data-tab="general" class="tab-button px-4 py-3 text-sm font-medium rounded-t-md text-slate-500 border-b-2 border-transparent hover:text-sky-600 hover:border-sky-300 focus:outline-none">
                                General
                                </button>
                                <button data-tab="variables" class="tab-button px-4 py-3 text-sm font-medium rounded-t-md text-slate-500 border-b-2 border-transparent hover:text-sky-600 hover:border-sky-300 focus:outline-none">
                                Variables
                                </button>
                                <button data-tab="params" class="tab-button px-4 py-3 text-sm font-medium rounded-t-md text-slate-500 border-b-2 border-transparent hover:text-sky-600 hover:border-sky-300 focus:outline-none">
                                OData Params
                                </button>
                            </nav>
                        </div>
                        <!-- Tab Content Container -->
                        <div id="tabContentContainer" class="space-y-6 min-h-[200px] pt-2">
                            <!-- Added pt-2 for spacing after tabs -->
                            <!-- General Tab -->
                            <div id="tab-general" class="tab-content space-y-4">
                                <div>
                                    <label for="connectionName" class="block mb-1.5 font-medium text-sm text-slate-700">Connection Name</label>
                                    <input type="text" id="connectionName" placeholder="e.g., My Production API" class="w-full px-3 py-2.5 bg-white border border-slate-300 rounded-lg text-sm focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none transition-colors">
                                </div>
                                <div>
                                    <label for="apiUrl" class="block mb-1.5 font-medium text-sm text-slate-700">API URL <span class="text-xs text-slate-400">(use {{varName}})</span></label>
                                    <input type="text" id="apiUrl" placeholder="https://{{host}}/odata/{{entity}}" class="w-full px-3 py-2.5 bg-white border border-slate-300 rounded-lg text-sm focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none transition-colors font-mono">
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label for="username" class="block mb-1.5 font-medium text-sm text-slate-700">Username</label>
                                        <input type="text" id="username" placeholder="Optional" class="w-full px-3 py-2.5 bg-white border border-slate-300 rounded-lg text-sm focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none transition-colors">
                                    </div>
                                    <div>
                                        <label for="password" class="block mb-1.5 font-medium text-sm text-slate-700">Password</label>
                                        <input type="password" id="password" placeholder="Optional" class="w-full px-3 py-2.5 bg-white border border-slate-300 rounded-lg text-sm focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none transition-colors">
                                    </div>
                                </div>
                            </div>
                            <!-- Variables Tab -->
                            <div id="tab-variables" class="tab-content hidden space-y-4">
                                <div class="flex justify-between items-center">
                                    <p class="text-sm text-slate-600">Define key-value pairs for dynamic URL parts.</p>
                                    <button id="addVariableButton" type="button" class="text-sm bg-emerald-500 hover:bg-emerald-600 text-white py-1.5 px-3 rounded-md cursor-pointer transition-colors duration-150 flex items-center space-x-1">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                        </svg>
                                        <span>Add</span>
                                    </button>
                                </div>
                                <div id="variablesContainer" class="space-y-3 max-h-[20rem] overflow-y-auto pr-1 -mr-1 border border-slate-200 rounded-lg p-3 bg-slate-50/50">
                                    <p class="text-slate-400 text-sm text-center py-2 variable-placeholder">No variables defined.</p>
                                </div>
                            </div>
                            <!-- OData Params Tab -->
                            <div id="tab-params" class="tab-content hidden space-y-4">
                                <p class="text-sm text-slate-600">Specify OData query options. Use <code class="text-xs bg-slate-200 p-0.5 rounded">{{varName}}</code> here too.</p>
                                <div class="grid grid-cols-1 gap-4">
                                    <div>
                                        <label for="paramFilter" class="block mb-1 font-medium text-xs text-slate-600">$filter <span class="text-slate-400 text-[10px]">(OData syntax, e.g., property eq 'value')</span></label>
                                        <textarea id="paramFilter" rows="4" placeholder="Status eq 'Active' and StartDate ge {{currentDate}}" class="w-full px-3 py-2 bg-white border border-slate-300 rounded-lg text-sm focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none transition-colors font-mono"></textarea>
                                    </div>
                                    <div>
                                        <label for="paramOrderby" class="block mb-1 font-medium text-xs text-slate-600">$orderby</label>
                                        <input type="text" id="paramOrderby" placeholder="e.g., CreatedDate desc" class="w-full px-3 py-2.5 bg-white border border-slate-300 rounded-lg text-sm focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none transition-colors font-mono">
                                    </div>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        <div>
                                            <label for="paramTop" class="block mb-1 font-medium text-xs text-slate-600">$top <span class="text-slate-400">(number or {{var}})</span></label>
                                            <input type="text" id="paramTop" placeholder="e.g., 100 or {{pageSize}}" class="w-full px-3 py-2.5 bg-white border border-slate-300 rounded-lg text-sm focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none transition-colors font-mono">
                                        </div>
                                        <div>
                                            <label for="paramSkip" class="block mb-1 font-medium text-xs text-slate-600">$skip <span class="text-slate-400">(number or {{var}})</span></label>
                                            <input type="text" id="paramSkip" placeholder="e.g., 0 or {{offset}}" class="w-full px-3 py-2.5 bg-white border border-slate-300 rounded-lg text-sm focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none transition-colors font-mono">
                                        </div>
                                    </div>
                                    <div>
                                        <label for="paramSelect" class="block mb-1 font-medium text-xs text-slate-600">$select</label>
                                        <input type="text" id="paramSelect" placeholder="e.g., Id,Name,Status" class="w-full px-3 py-2.5 bg-white border border-slate-300 rounded-lg text-sm focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none transition-colors font-mono">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Action Buttons -->
                        <div class="pt-6 border-t border-slate-200 flex flex-col sm:flex-row sm:items-center space-y-3 sm:space-y-0 sm:space-x-3">
                            <button id="fetchButton" class="w-full sm:w-auto flex items-center justify-center space-x-2 bg-sky-500 hover:bg-sky-600 text-white font-bold py-2.5 px-6 rounded-lg transition-colors duration-150 cursor-pointer text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                                <span>Fetch</span>
                            </button>
                            <button id="fetchAndDownloadButton" class="w-full sm:w-auto flex items-center justify-center space-x-2 bg-teal-500 hover:bg-teal-600 text-white font-bold py-2.5 px-6 rounded-lg transition-colors duration-150 cursor-pointer text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                                </svg>
                                <span>Fetch & Download</span>
                            </button>
                            <button id="downloadButton" disabled class="w-full sm:w-auto flex items-center justify-center space-x-2 bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2.5 px-6 rounded-lg transition-colors duration-150 cursor-pointer text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                                <span>Download CSV</span>
                            </button>
                        </div>
                    </div>
                    <!-- Activity Log Pane (Fixed Height, Scrollable) -->
                    <div class="h-[200px] md:h-[250px] flex flex-col border-t border-slate-200 bg-slate-800 text-slate-300 p-3 md:p-4 flex-shrink-0">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-sm font-semibold text-slate-400 uppercase tracking-wider">Activity Log</h3>
                            <button id="clearLogButton" class="text-xs text-slate-400 hover:text-sky-400 py-1 px-2 rounded-md cursor-pointer transition-colors duration-150 flex items-center space-x-1">
                                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                                <span>Clear</span>
                            </button>
                        </div>
                        <div id="status" class="flex-grow overflow-y-auto font-mono text-xs whitespace-pre-wrap break-words pr-1 -mr-1">
                            <!-- JS will populate this -->
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <!-- Generic Modal -->
        <div id="modal" class="fixed inset-0 z-[100] flex items-center justify-center p-4 hidden">
            <div id="modalBackdrop" class="modal-backdrop fixed inset-0 bg-black bg-opacity-70 opacity-0"></div>
            <div id="modalContent" class="modal-content bg-white rounded-lg shadow-xl p-6 w-full max-w-md transform scale-95 opacity-0 relative z-10">
                <div class="flex items-start">
                    <div id="modalIconContainer" class="mr-4 flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full sm:h-10 sm:w-10">
                        <!-- Icon will be injected by JS -->
                    </div>
                    <div class="flex-grow">
                        <h3 id="modalTitle" class="text-lg leading-6 font-medium text-slate-900">Modal Title</h3>
                        <div class="mt-2">
                            <p id="modalMessage" class="text-sm text-slate-600">Modal message goes here.</p>
                        </div>
                    </div>
                </div>
                <div id="modalInputContainer" class="mt-4 hidden">
                    <label id="modalInputLabel" for="modalTextInput" class="block text-sm font-medium text-slate-700">Input:</label>
                    <input type="text" id="modalTextInput" class="mt-1 w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none transition-colors">
                </div>
                <div class="mt-5 sm:mt-6 sm:flex sm:flex-row-reverse space-y-2 sm:space-y-0 sm:space-x-3 sm:space-x-reverse">
                    <button id="modalConfirmButton" type="button" class="w-full sm:w-auto inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 text-base font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 sm:text-sm cursor-pointer">
                    Confirm
                    </button>
                    <button id="modalCancelButton" type="button" class="w-full sm:w-auto inline-flex justify-center rounded-md border border-slate-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-slate-700 hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 sm:text-sm cursor-pointer">
                    Cancel
                    </button>
                </div>
            </div>
        </div>
        <script src="script.js"></script>
    </body>
</html>
